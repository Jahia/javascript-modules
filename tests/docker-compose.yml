services:
  jahia:
    image: "${JAHIA_IMAGE}"
    container_name: jahia
    ports:
      - "8080:8080"
      - "8101:8101"
      - "8000:8000"
      - "9229:9229"
      - "10229:10229" # to test the debugger on a different port
    environment:
      - SUPER_USER_PASSWORD=${SUPER_USER_PASSWORD}
      - JAHIA_LICENSE=${JAHIA_LICENSE}
      - JPDA=true
      - CATALINA_CONTEXT=${CATALINA_CONTEXT}
    extra_hosts:
      - jahia:127.0.0.1
    networks:
      - stack
  # Cypress container
  cypress:
    image: "${TESTS_IMAGE}"
    # https://github.com/cypress-io/cypress/issues/350
    ipc: host
    container_name: cypress
    depends_on:
      - jahia
    environment:
      - MANIFEST=${MANIFEST}
      - SUPER_USER_PASSWORD=${SUPER_USER_PASSWORD}
      # CONTEXT_PATH can be '' (empty string, default) or '/my-context'
      - JAHIA_URL=${JAHIA_URL:-http://jahia:8080}${CONTEXT_PATH}
      - NEXUS_USERNAME=${NEXUS_USERNAME}
      - NEXUS_PASSWORD=${NEXUS_PASSWORD}
    networks:
      - stack
networks:
  stack:
